#include <BluetoothSerial.h>
#include <ESP32Servo.h>

BluetoothSerial BT;
Servo myservo;

// -------- PIN DEFINITIONS --------
#define SERVO_PIN 18

// Motor A Pins
#define IN1 25
#define IN2 26
#define ENA 19

// Motor B Pins
#define IN3 27
#define IN4 14
#define ENB 21

// -------- SETUP --------
void setup() {
  Serial.begin(115200);
  BT.begin("ESP32_Control");  // Bluetooth Name

  // Servo Setup
  myservo.attach(SERVO_PIN);

  // Motors Setup
  pinMode(IN1, OUTPUT);
  pinMode(IN2, OUTPUT);
  pinMode(ENA, OUTPUT);

  pinMode(IN3, OUTPUT);
  pinMode(IN4, OUTPUT);
  pinMode(ENB, OUTPUT);

  // Stop motors initially
  stopMotorA();
  stopMotorB();

  Serial.println("Ready. Connect via Bluetooth.");
}

// -------- MOTOR CONTROL FUNCTIONS --------
void runMotorA(int speed) {
  digitalWrite(IN1, HIGH);
  digitalWrite(IN2, LOW);
  analogWrite(ENA, speed);   // Speed control
}

void runMotorB(int speed) {
  digitalWrite(IN3, HIGH);
  digitalWrite(IN4, LOW);
  analogWrite(ENB, speed);   // Speed control
}

void stopMotorA() {
  analogWrite(ENA, 0);
  digitalWrite(IN1, LOW);
  digitalWrite(IN2, LOW);
}

void stopMotorB() {
  analogWrite(ENB, 0);
  digitalWrite(IN3, LOW);
  digitalWrite(IN4, LOW);
}

// -------- LOOP --------
void loop() {
  if (BT.available()) {
    char cmd = BT.read();
    Serial.println(cmd);

    // ---- SERVO CONTROL ----
    if (cmd == 'L')  myservo.write(45);   // Left
    if (cmd == 'C')  myservo.write(90);   // Center
    if (cmd == 'R')  myservo.write(135);  // Right

    // ---- MOTOR A ----
    if (cmd == 'A') runMotorA(150);   // Medium speed
    if (cmd == 'a') runMotorA(255);   // High speed
    if (cmd == 'S') stopMotorA();     // Stop

    // ---- MOTOR B ----
    if (cmd == 'B') runMotorB(150);   // Medium speed
    if (cmd == 'b') runMotorB(255);   // High speed
    if (cmd == 'T') stopMotorB();     // Stop
  }
}